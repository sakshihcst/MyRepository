<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd
        http://www.springframework.org/schema/tx
		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd
		http://www.springframework.org/schema/mvc
		http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
		http://www.springframework.org/schema/task
		http://www.springframework.org/schema/task/spring-task-3.0.xsd">
 

 	<aop:aspectj-autoproxy proxy-target-class="true" />
 	
	<tx:annotation-driven  transaction-manager="transactionManager"/>
	<context:component-scan base-package="com.searshc.mpuwebservice" />
	<context:component-scan base-package="com.sears.dj.common.mpu" />
	<context:component-scan base-package="com.searshc" />
	
	 <context:component-scan base-package="com.sears.dj.common.wsprofiler.aop" /> 
	<context:component-scan base-package="com.sears.dj.common.wsprofiler.ws" />
	
	<context:annotation-config />
	<task:annotation-driven executor="myExecutor" scheduler="myScheduler"/>

<task:executor id="myExecutor" pool-size="5"/>

<task:scheduler id="myScheduler" pool-size="10"/>
	<bean id="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver" />

	<!-- <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"> 
		<constructor-arg ref="dataSource"/> </bean> -->

	<!-- <bean id="namedParameterJdbcTemplate" class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate"> 
		<constructor-arg ref="dataSource"/> </bean> -->

<!-- 	<tx:jta-transaction-manager /> -->
<!-- 	<tx:annotation-driven transaction-manager="txManager" />

	<bean id="txManager"
		class="org.springframework.transaction.jta.JtaTransactionManager" /> -->
		
<!-- 	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dj_mpu1" />
	</bean> -->
	
	<bean id="transactionManager" class="com.sears.dj.common.tx.ChainedTransactionManager">
		<property name="transactionManagers">
			<list>
				<bean
				class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
				<property name="dataSource" ref="dj_mpu1" />
				</bean>
				<bean
				class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
				<property name="dataSource" ref="dj_mpu2" />
				</bean>
				<bean
				class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
				<property name="dataSource" ref="dj_mpu3" />
				</bean>
				<bean
				class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
				<property name="dataSource" ref="dj_mpu4" />
				</bean>
			</list>
		</property>
	</bean>

	<!-- To enable @RequestMapping process on type level and method level -->
	<!-- <context:component-scan base-package="com.searshc" /> -->

	<context:annotation-config />
	
	
	<!-- <bean id="jaxbMarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>

				<value>com.sears.mpu.backoffice.domain.OrderAdaptorRequest</value>
				<value>com.sears.mpu.backoffice.domain.OrderAdaptorResponse</value>

			</list>
		</property>
	</bean> -->
    
    <bean id="jaxb2MessageConverter"
		class="org.springframework.http.converter.xml.Jaxb2RootElementHttpMessageConverter">
		<property name="supportedMediaTypes">
		<list>
		<value>application/xml</value>
		
		<value>text/xml</value>
		</list>
		</property>
		</bean>
    
    <bean id="marshallingHttpMessageConverter"
class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter">
		<property name="marshaller" ref="jaxb2Marshaller" />
		<property name="unmarshaller" ref="jaxb2Marshaller" />
		<property name="supportedMediaTypes">
		<list>
		<value>application/xml</value>
		<value>text/xml</value>
		</list>
		</property>
		</bean>

<bean id="jaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
		<list>
	           <value>com.sears.mpu.backoffice.domain.OrderAdaptorRequest</value>
				<value>com.sears.mpu.backoffice.domain.OrderAdaptorResponse</value>
		</list>
		</property>
		</bean>
    


	<!-- To enable @RequestMapping process on type level and method level -->
	<bean
		class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
	<bean
		class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
		<property name="messageConverters">
			<list>
				<ref bean="jsonConverter" />
				<ref bean="jaxb2MessageConverter" />
			</list>
		</property>
	</bean>

  

	<bean id="jsonConverter"
		class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">
		<property name="supportedMediaTypes" value="application/json;charset=UTF-8" />
	</bean>

	<bean id="restTemplate" class="org.springframework.web.client.RestTemplate">
		<property name="messageConverters">
			<list>
                <ref bean="marshallingHttpMessageConverter" />
				<bean
				class="org.springframework.http.converter.xml.Jaxb2RootElementHttpMessageConverter" />
				<bean
				class="org.springframework.http.converter.StringHttpMessageConverter" />
			    <ref bean="jsonConverter" />
				<bean
				class="org.springframework.http.converter.xml.SourceHttpMessageConverter" />
			</list>
		</property>
	</bean>


	<bean
		class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
		<property name="mediaTypes">
			<map>
				<entry key="xml" value="application/xml" />
				<entry key="html" value="text/html" />
				<entry key="json" value="application/json" />
			</map>
		</property>
		<property name="viewResolvers">
			<list>
				<bean class="org.springframework.web.servlet.view.BeanNameViewResolver" />
				<bean id="viewResolver"
					class="org.springframework.web.servlet.view.UrlBasedViewResolver">
					<property name="viewClass"
						value="org.springframework.web.servlet.view.JstlView" />
					<property name="prefix" value="/WEB-INF/jsp/" />
					<property name="suffix" value=".jsp" />
				</bean>
			</list>
		</property>
	</bean>
	<bean id="propertyUtils" class="com.searshc.mpuwebservice.util.PropertyUtils">
		<property name="locations">
			<list>
			    <value>classpath:mpu_sql.properties</value>
				<value>classpath:mpu.properties</value>
				<value>classpath:mpu_messages.properties</value>
			</list>
		</property>
	</bean>
	<!-- DJCommon Interceptor added -->
	<mvc:interceptors>
		<bean class="com.sears.dj.common.mpu.interceptor.WSProfileInterceptor" />
	</mvc:interceptors> 
</beans>
